@model List<Post>
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		  content="width=device-width, initial-scale=1.0">
	<title>Drum Pages Admin</title>
	<link rel="stylesheet" href="~/css/admin.css">
</head>

<body>

	<div class="header"><span class="header-text">DRUM PAGES<span class="headerPage"><br>Admin Panel</span></span></div>



	<div class="main-container row">
		<div class="navcontainer col-2">
			<nav class="nav">
				<div class="nav-upper-options">
					@*PRZYCISK FORUM*@
					<form>
						<div class="nav-option option1" onclick="showusersscript('forum')">
						<img src="~/images/posts.png"
							 class="nav-img"
							 alt="forum">
						<h3>Forum</h3>
					</div>
					</form>

					@* PRZYCISK KOMENTARZE *@
					<form>
						<div class="nav-option option2" onclick="showusersscript('comm')">
							<img src="~/images/posts.png"
								 class="nav-img"
								 alt="forum">
							<h3>Comments</h3>
						</div>
					</form>

					 @* PRZYCISK UZYTKOWNICY  *@
					<form>
						<div class="option3 nav-option" onclick="showusersscript('user')">
						<img src="~/images/posts.png"
							 class="nav-img"
							 alt="users">
						<h3>Users</h3>
					</div>
					</form>


					@* PRZYCISK OCZEKUJACY PRO  *@
					<form>
						<div class="nav-option option4" onclick="showusersscript('requestbutton')">
						<img src="~/images/report.png"
							 class="nav-img"
							 alt="request">
						<h3>Requests</h3>
					</div>
					</form>




					<div class="nav-option option5">
						<img src="~/images/profile.png"
							 class="nav-img"
							 alt="lesson">
						<h3>Lessons</h3>
					</div>


					@* !!!!!WYLOGOWANIE SIE - TRZEBA POPRAWIC ZE WZGLEDU NA WYGLAD!!!!!  *@
						<div class="nav-option logout" id="logoutBtn">
							<img src="~/images/logout.png"
								 class="nav-img"
								 alt="logout">
							<h3>Logout</h3>
						</div>

				</div>
			</nav>
		</div>
		<div class="col-2"></div>

		@* FORUM *@
		<div class="col-8" id="forum1">

			<div class="row">
				<div class="row">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">60.5k</span>
							<span class="topic">Post Views</span>
						</div>

						<img src="~/images/eye.png"
							 alt="Views">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">150</span>
							<span class="topic">Likes</span>
						</div>

						<img src="~/images/like.png"
							 alt="likes">
					</div>
				</div><div class="row boxRow">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@Post.GetAllPosts().Count()</span>
							<span class="topic">Comments</span>
						</div>

						<img src="~/images/chat.png"
							 alt="comments">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@Thread.GetAllThreads().Count()</span>
							<span class="topic">Threads Published</span>
						</div>

						<img src="~/images/Ok.png" alt="published">
					</div>

					<div class="col-1"></div>
				</div>

			</div>

			<form method="post" asp-controller="Admin" asp-action="EditThread">
				<div>
					<label for="threadId">Thread Id:</label>
					<select name="threadId">
						@foreach (var i in Thread.GetAllThreads())
						{
							<option value="@i.getID()">
								@i.getID()
							</option>
						}

					</select>
					<button type="submit">Submit</button>
				</div>

				<div>
					<label for="editAction">Change:</label>
					<select name="editAction" id="editActionSelector" onchange="toggleInputFields()">
						<option value="t_name">Thread name</option>
						<option value="author">Author</option>
					</select>
				</div>

				<div id="t_name_input_div">
					<label for="t_name_input">New Name:</label>
					<input type="text" id="t_name_input" name="t_name_input">
				</div>

				<div id="user_id_input_div" style="display:none;">
					<label for="user_id_input">Select New User:</label>
					<select name="user_id_input">
						@foreach (var i in MainUser.GetAllUsers())
						{
							<option value="@i.getId()">
								@i.getId()
							</option>
						}
					</select>
				</div>
			</form>

			<script>
				function toggleInputFields() {
					var editActionSelector = document.getElementById("editActionSelector");
					var tNameInput = document.getElementById("t_name_input_div");
					var userIdInputDiv = document.getElementById("user_id_input_div");

					if (editActionSelector.value === "t_name") {
						tNameInput.style.display = "block";
						userIdInputDiv.style.display = "none";
					} else if (editActionSelector.value === "author") {
						tNameInput.style.display = "none";
						userIdInputDiv.style.display = "block";
					}
				}
			</script>

			<div class="report-container row">
				<div class="col-12">
					<div class="report-header">
						<h1 class="recent-Posts">Recent Posts</h1>
						<button class="view">View All</button>
					</div>

					<div class="report-body">
						<div class="report-topic-heading row">
							<h3 class="t-op col-3">Thread</h3>
							<h3 class="t-op col-3">Comments</h3>
							<h3 class="t-op col-3">Author</h3>
							<h3 class="t-op col-3">Publish date</h3>
							<h3 class="t-op col-3">Action</h3>
						</div>

						<div class="items">
							@* tu petla wyswietlacjaca te posty  *@
							@foreach (var i in Thread.GetAllThreads())
							{
								<div class="item1 row">
									<h3 class="t-op-nextlvl col-3 col-3">@i.getTheme()</h3>
									<h3 class="t-op-nextlvl col-3">@Post.GetPostsByThreadId(i.getID()).Count()</h3>
									<h3 class="t-op-nextlvl col-3">@MainUser.GetUserById(i.getUserID()).user.getLogin()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getDate()</h3>
									<form method="post" asp-controller="Admin" asp-action="DeleteThread" asp-route-id="@i.getID()">
										<button type="submit" class="t-op-nextlvl col-3 label-tag">Delete</button>
									</form>
								</div>
							}
						</div>
					</div>
				</div>
			</div>
		</div>

		@* ZAKLADKA KOMENTARZE *@
		<div class="col-8" id="commentv" style="display: none;">

			<div class="row">
				<div class="row">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">60.5k</span>
							<span class="topic">Total Comments</span>
						</div>

						<img src="~/images/eye.png"
							 alt="Views">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">150</span>
							<span class="topic">Likes</span>
						</div>

						<img src="~/images/like.png"
							 alt="likes">
					</div>
				</div><div class="row boxRow">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@Post.GetAllPosts().Count()</span>
							<span class="topic">Comments</span>
						</div>

						<img src="~/images/chat.png"
							 alt="comments">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@Thread.GetAllThreads().Count()</span>
							<span class="topic">Threads Published</span>
						</div>

						<img src="~/images/Ok.png" alt="published">
					</div>

					<div class="col-1"></div>
				</div>

			</div>
			@* DO ZROBIENIA DYNAMICZNIE WYSWIETLANIE KOMENTARZY W ZALEZNOSCI OD WYBRANEGO WATKU *@
			<form method="post" asp-controller="Admin" asp-action="DeleteComment">
				<div>
					<label for="comthreadId">Thread Id:</label>
					<select name="comthreadId" id="comthreadIdSelect">
						@foreach (var i in Thread.GetAllThreads())
						{
							<option value="@i.getID()">
								@i.getID()
							</option>
						}

					</select>
					<label for="comId">Com Id:</label>
					<select name="comId" id="comIdSelect">
						 @foreach (var i in Post.GetPostsByThreadId(Thread.GetAllThreads().FirstOrDefault().getID()))
						{
							<option value="@i.getID()">
								@i.getID()
							</option>
						} 

					</select>
					<button type="submit" id="deletecombutton">Delete Comment</button>
				</div>			
			</form>

			<div class="report-container row">
				<div class="col-12">
					<div class="report-header">
						<h1 class="recent-Posts">Recent Posts</h1>
						<button class="view">View All</button>
					</div>

					<div class="report-body">
						<div class="report-topic-heading row">
							<h3 class="t-op col-3">ID</h3>
							<h3 class="t-op col-3">Content</h3>
							<h3 class="t-op col-3">Author ID</h3>
							<h3 class="t-op col-3">Date</h3>
						</div>

					
						<div class="items" id="postsContainer">
							@* tu petla wyswietlacjaca te posty  *@
							@* @foreach (var i in Model)
							{
								<div class="item1 row">
									<h3 class="t-op-nextlvl col-3 col-3">@i.getID()</h3>
									<h3 class="t-op-nextlvl col-3 col-3">@i.getContent()</h3>
									<h3 class="t-op-nextlvl col-3 col-3">@i.getUserID()</h3>
									<h3 class="t-op-nextlvl col-3 col-3">@i.getCreationDate()</h3>
								</div>
							} *@
						</div>
					</div>
				</div>
			</div>
			<script>
				var comthreadIdSelect = document.getElementById('comthreadIdSelect');
				var postsContainer = document.getElementById('postsContainer');
				var comPicker = document.getElementById('comIdSelect');
				var delButton = document.getElementById('deletecombutton');
				
				var logoutButton = document.getElementById('logoutBtn');

				logoutButton.addEventListener('click', function () {
					fetch('/Home/LogOut', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/x-www-form-urlencoded'
						},
						body: '' // Dodaj tutaj ewentualne dane do przesłania
					})
						.then(response => {
							if (response.ok) {
								// Przekieruj do strony index po poprawnym wylogowaniu
								window.location.href = '/Home/Index';
							} else {
								console.error('Błąd podczas wylogowywania');
							}
						})
						.catch(error => console.error('Error:', error));
				});



				// Dodaj obs�ug� zdarzenia onchange dla select
				comthreadIdSelect.addEventListener('change', function () {
					// Pobierz warto�� wybran� w select
					var selectedThreadId = comthreadIdSelect.value;

					// Wy�lij zapytanie AJAX, aby pobra� nowe dane na podstawie wybranego ID w�tku
					fetch('/Admin/testA?threadId=' + selectedThreadId)
						.then(response => response.json())
						.then(data => {
							comPicker.innerHTML = '';
							postsContainer.innerHTML = ''; 
							if (data.length === 0)
								{
								delButton.style.display = 'none';
							}
							else {
								delButton.style.display = 'inline';
							}																		
							data.forEach(post => {
								postsContainer.innerHTML += `
														<div class="item1 row">
														<h3 class="t-op-nextlvl col-3 col-3">${post.id}</h3>
														<h3 class="t-op-nextlvl col-3 col-3">${post.content}</h3>
														<h3 class="t-op-nextlvl col-3 col-3">${post.uid}</h3>
														<h3 class="t-op-nextlvl col-3 col-3">${post.datum}</h3>
														</div>
													`;
								comPicker.add(new Option(post.id, post.id), undefined);
							});
						})
						.catch(error => console.error('Error:', error));
				});
			</script>

		</div>




		@*ZAKLADKA MODYFIKACJI USERA*@
		<div class="col-8" id="usr" style="display: none;">
			<div class="row">
				<div class="row">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@MainUser.GetAllUsers().Count()</span>
							<span class="topic">Registered Users</span>
						</div>

						<img src="~/images/eye.png"
							 alt="Views">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@MainUser.GetAllUsers().Where(user => user.getAccountType() == "Pro").ToList().Count()</span>
							<span class="topic">Pro Users</span>
						</div>

						<img src="~/images/like.png"
							 alt="likes">
					</div>
				</div><div class="row boxRow">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@MainUser.GetAllUsers().Where(user => user.getAccountType() == "NPro").ToList().Count()</span>
							<span class="topic">Pending Pro Users</span>
						</div>

						<img src="~/images/chat.png"
							 alt="comments">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">0</span>
							<span class="topic">propozycja</span>
						</div>

						<img src="~/images/Ok.png" alt="published">
					</div>

					<div class="col-1"></div>
				</div>

			</div>

			<form method="post" asp-controller="Admin" asp-action="EditUser">
				<div>
					<label for="threadId">User Id:</label>
					<select name="userId">
						@foreach (var i in MainUser.GetAllUsers())
						{
							<option value="@i.getId()" title="@i.getLogin()">
								@i.getId()
							</option>
						}
					</select>
					<button type="submit" onclick="showusersscript('user')">Submit</button>
				</div>


				<div>
					<label for="editAction">Change:</label>
					<select name="editAction" id="usersEditActionSelector" onchange="toggleUsersInputFields()">
						<option value="t_login">Login</option>
						<option value="t_name">Name</option>
						<option value="t_lastname">Last Name</option>
						<option value="t_age">Age</option>
						<option value="t_skill">Skill</option>
						<option value="t_type">Type</option>
						<option value="t_mail">Mail</option>
					</select>
				</div>

				<div id="t_login_input_div">
					<label for="t_login_input">New Login:</label>
					<input type="text" id="t_login_input" name="t_login_input">
				</div>

				<div id="t_m_input_div" style="display:none;">
					<label for="t_name_input">New Name:</label>
					<input type="text" id="t_name_input" name="t_name_input">
				</div>

				<div id="t_lname_input_div" style="display:none;">
					<label for="t_lname_input">New Last Name:</label>
					<input type="text" id="t_lname_input" name="t_lname_input">
				</div>

				<div id="t_age_input_div" style="display:none;">
					<label for="t_age_input">New Age:</label>
					<input type="number" min="0" max="120" id="t_age_input" name="t_age_input">
				</div>

				<div id="type_input_div" style="display:none;">
					<label for="type_input">Select Type:</label>
					<select name="type_input">
						<option value="Pro">Pro</option>
						<option value="NPro">Want be Pro</option>
						<option value="Causal">Casual</option>
					</select>
				</div>
				<div id="skill_input_div" style="display:none;">
					<label for="skill_input">Select Skill:</label>
					<select name="skill_input">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
					</select>
				</div>

				<div id="t_email_input_div" style="display:none;">
					<label for="t_email_input">New Email:</label>
					<input type="email" id="t_email_input" name="t_email_input" >
				</div>
			</form>


			<script>
				function toggleUsersInputFields() {
					var editActionSelector = document.getElementById("usersEditActionSelector");
					var login = document.getElementById("t_login_input_div");
					var fname = document.getElementById("t_m_input_div");
					var lname = document.getElementById("t_lname_input_div");
					var age = document.getElementById("t_age_input_div");
					var type= document.getElementById("type_input_div");
					var skill = document.getElementById("skill_input_div");
					var email = document.getElementById("t_email_input_div");

					login.style.display = "none";
					fname.style.display = "none";
					lname.style.display = "none";
					age.style.display = "none";
					type.style.display = "none";
					skill.style.display = "none";
					email.style.display = "none";
					

					if (editActionSelector.value === "t_login") {
						login.style.display = "block";
						
						
					} else if (editActionSelector.value === "t_name") {
						fname.style.display = "block";	
						
					}
					 else if (editActionSelector.value === "t_lastname") {					
						lname.style.display = "block";		
						
					}
					 else if (editActionSelector.value === "t_age") {						
						age.style.display = "block";
						
					}
					 else if (editActionSelector.value === "t_skill") {						
						skill.style.display = "block";
					
					}
					 else if (editActionSelector.value === "t_type") {					
						type.style.display = "block";
					
					}
					else if (editActionSelector.value === "t_mail") {						
						email.style.display = "block";
					
					}
				}
			</script>

			<div class="report-container row">
				<div class="col-12">
					<div class="report-header">
						<h1 class="recent-Posts">Users List</h1>
						<button class="view">View All</button>
					</div>

			

					<div class="report-body">
						<form>
							<div class="report-topic-heading row">
								<button class="t-op col-3" type="submit" name="sortBy" value="id" onclick="showusersscript('user')">User Id</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="login" onclick="showusersscript('user')">Login</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="name" onclick="showusersscript('user')">Name</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="lname" onclick="showusersscript('user')">Last Name</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="age" onclick="showusersscript('user')">Age</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="type" onclick="showusersscript('user')">Type</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="skill" onclick="showusersscript('user')">Skill</button>
								<button class="t-op col-3" type="submit" name="sortBy" value="mail" onclick="showusersscript('user')">E-mail</button>
						</div>
						</form>

						<div class="items" id ="userList">
							@* tu petla wyswietlacjaca te posty  *@
							@foreach (var i in MainUser.GetAllUsers())
							{
								<div class="item1 row">
									<h3 class="t-op-nextlvl col-3 col-3">@i.getId()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getLogin()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getName()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getLastName()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getAge()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getAccountType()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getSkills()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getEmial()</h3>
									<form method="post" asp-controller="Admin" asp-action="DeleteUser" asp-route-id="@i.getId()">
										<button type="submit" class="t-op-nextlvl col-3 label-tag" onclick="showusersscript('user')">Delete</button>
									</form>
								</div>
							}
						</div>
					</div>			
				</div>
			</div>
		</div>

		@* ZAKLADKA ZMIANA STATUSU *@
		<div class="col-8" id="requestUser" style="display: none;">

			<div class="row">
				<div class="row">

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@MainUser.GetAllUsers().Where(user => user.getAccountType() == "NPro").ToList().Count()</span>
							<span class="topic">Pending Users</span>
						</div>

						<img src="~/images/eye.png"
							 alt="Views">
					</div>

					<div class="col-2"></div>

					<div class="box col-5">
						<div class="text">
							<span class="topic-heading">@MainUser.GetAllUsers().Where(user => user.getAccountType() == "Pro").ToList().Count()</span>
							<span class="topic">Total Pros</span>
						</div>

						<img src="~/images/like.png"
							 alt="likes">
					</div>
				</div><div class="row boxRow">

					<div class="col-1"></div>
				</div>

			</div>

 
			<div class="report-container row">
				<div class="col-12">
					<div class="report-header">
						<h1 class="recent-Posts">Requests for change the status </h1>
						<button class="view">View All</button>
					</div>

					<div class="report-body">
						<div class="report-topic-heading row">
							<h3 class="t-op col-3">User Id</h3>
							<h3 class="t-op col-3">Login</h3>
							<h3 class="t-op col-3">Type</h3>
							<h3 class="t-op col-3">E-mail</h3>
							<h3 class="t-op col-3">Set to Pro</h3>
					</div>

						<div class="items">
							@* tu petla wyswietlacjaca te posty  *@
							@foreach (var i in MainUser.GetAllUsers().Where(user => user.getAccountType() == "NPro").ToList())
							{
								<div class="item1 row">
									<h3 class="t-op-nextlvl col-3 col-3">@i.getId()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getLogin()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getAccountType()</h3>
									<h3 class="t-op-nextlvl col-3">@i.getEmial()</h3>
									<form method="post" asp-controller="Admin" asp-action="SetToPro" asp-route-id="@i.getId()">
										<button type="submit" class="t-op-nextlvl col-3 label-tag">Accept</button>
									</form>
								</div>
							}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		function showusersscript(buttonId) {
			var forumView = document.getElementById('forum1');
			var usrView = document.getElementById('usr');
			var reqView = document.getElementById('requestUser');
			var comView = document.getElementById('commentv');
			
			  if (buttonId === 'forum') {
				usrView.style.display = "none";
				forumView.style.display = "block";
				reqView.style.display = "none";
				comView.style.display = "none";
			  }else if (buttonId === 'user')
			  {
				forumView.style.display = "none";
			  	usrView.style.display = "block";
				reqView.style.display = "none";
				comView.style.display = "none";
			  }
			else if (buttonId === 'requestbutton') {
				forumView.style.display = "none";
				usrView.style.display = "none";
				reqView.style.display = "block";
				comView.style.display = "none";
			}
			else if (buttonId === 'comm') {
				forumView.style.display = "none";
				usrView.style.display = "none";
				reqView.style.display = "none";
				comView.style.display = "block";
			}


			localStorage.setItem('selectedTab', buttonId);
	}
		window.onload = function () {
			var selectedTab = localStorage.getItem('selectedTab');
			if (selectedTab) {
			showusersscript(selectedTab);
			}
		}
	</script>
</body>
</html>
